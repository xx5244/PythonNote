# Pandas
---

+ ## 結構化數據分析利器(依賴Numpy)
+ ## 提供多種高級數據結構
    1. Time-Series
    2. DataFrame
    3. Panel
+ ## 強大數據索引和處理能力

+ ## Series
  + ### 說明
    **Pandas套件底下的方法，一維維度的表格，以list為基底**
  + ### 範例
    ```python
    import numpy as np
    import pandas as pd

    a = [1, 2, 3, 4]

    # 創建一個Series
    # s = pd.Series(a)
    # print(s)  # 印出內容
    # print(s.index)    # 印出索引
    # print(s.values)   # 印出值
    # print("索引1的值:", s[1]) # 索引方式印出值
    # print("最大值:", s.max())
    # print("最小值:", s.min())
    # print("中位數:", s.median())
    # print("資料放大兩倍:", s * 2, sep="\n")

    # 篩選資料
    # condition = s > 2
    # print("內容值大於2的內容:", s[condition], sep="\n")


    # 自定義index
    # s1 = Series(a, index=['A', 'B', 'C', 'D'])
    # print(s1)

    # 透過numpy的array創建Series
    # s2 = Series(np.arange(5))
    # print(s2)

    # 透過字典創建Series
    # d = {
    #     'A': 1,
    #     'B': 2,
    #     'C': 3,
    #     'D': 4
    # }
    # s3 = pd.Series(d)
    # print(s3)
    # print(s3.index)
    # print(s3.values)

    # 將Series轉換成字典
    # d2 = s3.to_dict()
    # print(d2)


    """
    index會默認自動創建，也可以指定
    用字典創建的Series，字典中的key會變成index，而value就會變成value
    將Series轉成字典的話，就是index轉乘key，value轉成value
    """
    ```

+ ## DataFrame
  + ### 說明
    **Pandas套件底下的方法，二維維度的表格，以dict為基底**
  
  + ### 常用功能
    1. **製作資料**
       + #### 範例
          ```python
          import pandas as pd

          a = [1, 2, 3, 4]

          # 創建一個DataFrame
          ind = ['a', 'b', 'c']
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, 190, 230]
          }

          data = pd.DataFrame(data_dict)
          data2 = pd.DataFrame(data_dict, index=ind)  # 指定index

          print(data)
          print(f'{"="*30}')
          print(data2)
          ```
    2. **儲存資料**
       + #### 範例
          ```python
          import pandas as pd

          # 創建一個DataFrame
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, 190, 230]
          }

          data = pd.DataFrame(data_dict)
          data.to_csv('test.csv', encoding='utf-8', index=None)   # 輸出成csv檔
          """
          to_csv: 輸出成csv檔，當然也可以輸出成別的檔案類型，編碼建議用utf-8，index預設是有的，如果不要就要設定為None
          """       
          ```
    3. **讀取資料**
       + #### 範例
          ```python
          import pandas as pd

          data = pd.read_csv('test.csv', header=None) # 讀取csv檔
          print(data)
          """
          read_csv: 讀取csv檔變成DataFrame形式，header為是否把第一列當作是屬性，預設為是，如不要就要設定為None
          """          
          ```
    4. **查詢與篩選資料**
       + #### 範例
          ```python
          import pandas as pd

          # a = ['a', 'b', 'c']

          # 創建資料
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, 190, 230]
          }

          data = pd.DataFrame(data_dict)  # 不指定index
          # data = pd.DataFrame(data_dict, index=a) # 指定index
          # 查看row
          # print(data.head()) # 顯示前5 row
          # print(data.tail()) # 顯示後5 row

          # 查看column
          # print(data.columns) # 查看columns

          # 取row的內容
          # print(data[0:3])  # 直觀好用
          # print(data.loc[['a', 'b']])   # 指定index，文字類就不能用區間了，要將預讀取的row都一一列出
          # print(data.loc[0:2])  # 不指定index也可用區間
          # print(data.iloc[0:2])  

          # 讀取column內容
          # print(data['name'])
          # print(data.name)  # 不建議使用此方法
          # print(data.iloc[:, 0])

          # 讀取多column內容
          # print(DataFrame(data, columns=['name', 'heigh']))

          # 讀取row及column綜合運用
          # print(data.loc[0:2, ['name', 'salary']])
          # print(data.iloc[0:3, 0:2])

          # 查詢資料
          # print(data.isin([5000, 'Amy'])) # 找出DataFrame裡是否有值為5000或者'Amy'的
          # print(data['name'].isin(['Amy']))   # 找出name欄位裡有沒有叫'Amy'的

          # 篩選資料
          # condition = data['salary'] > 4000
          # print(data[condition])

          # 找
          """
          讀取row內容有三種方法
          法1. 讀取位置的，用區間的方式表示欲讀取的row的位置，
          法2. 讀取標籤的，loc，輸入欲讀取的row的標籤
          法3. 讀取位置的，iloc，同法1

          loc主要是根據index的標籤名來運作的，因此只要把標籤名改掉，loc內的值也要相對應改掉
          iloc主要是根據索引的位置來運作的，因此，即使把標籤名改掉，iloc內的值也不需要對應改掉

          如果用loc讀取僅一個row的話，顯示方式會不同，兩個以上就會是DataFrame的型式
          用loc，注意:如果沒指定index的話，那預設就是從0開始，這種情況下也能使用區間的模式，由於是用標籤來運作，所以區間的話前後是都有算的

          如果用iloc讀取僅一個row的話，顯示方式會不同，兩個以上就會是DataFrame的型式
          用iloc是取位置的，所以區間的話最後的數值都是不包含的

          讀取column內容有三種方法
          法1. 讀取欄位名，data['欄位名']
          法2. 讀取欄位名，data.'欄位名' - 此方法不建議使用，因為欄位名要是有空格就無法用了
          法3. 讀取位置，iloc[:, column的位置]，這邊是預設全部的row都要取

          iloc是取位置的，[row, column]內分兩個部分，row為row的位置，column為column的位置

          查詢資料
          用isin指令，傳回來的是布林值

          篩選資料
          利用讀取row、column、isin及運算符號來製作篩選條件，然後利用[]來篩選資料
          """          
          ```
    5. **替換資料**
       + #### 範例
          ```python
          import pandas as pd

          # 創建資料
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, 190, 230]
          }

          data = pd.DataFrame(data_dict)  # 不指定index

          # 一對一替換
          # data.replace('Amy', 'Linda', inplace=True)
          # print(data)

          # 多對一替換
          # data.replace(['Amy', 'John'], 'Linda', inplace=True)
          # print(data)

          # 多對多替換
          data.replace({'Amy': 'Linda', 3000: 6000}, inplace=True)
          print(data)


          """
          主要是用replace指令來替換，當中的inplace參數是指是否對原表直接做修改，預設為False
          多對多替換是用類似字典的型式
          """          
          ```
    6. **新增資料**
       + #### 範例
          ```python
          import pandas as pd

          # 創建資料
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, 190, 230]
          }

          data = pd.DataFrame(data_dict)  # 不指定index

          # 新增row
          # 法1
          # data.loc[3] = ['tester', 1000000, 199]
          # data.loc[len(data)] = ['tester', 1000000, 199]
          # print(data)

          # 法2
          # data = data.append({'name': 'Linda', 'salary': 9000, 'heigh': 160}, ignore_index=True)
          # print(data)

          # 新增column
          # 法1
          # data['new'] = [100, 300, 800]
          # print(data)

          # 法2
          # data['new'] = pd.Series([100, 300])
          # print(data)

          # 插入
          # data.insert(1, 'weight', [100, 300, 800], allow_duplicates=True)
          # print(data)

          """
          新增row的兩種方法
          法1. df.loc[index名] = 值，index名可數字可文字，給予的值需符合column的長度，可搭配len來直接給予index名
          法2. 利用append，然後配合字典型式傳入想新增的資料，ignore_index是表示是否用各自原來的index label，預設為False

          新增column有兩種方法
          法1. 直接輸入欲新增的欄位名，給予的值需符合row的長度
          法2. 輸入欲新增的欄位名搭配Series給予值，給予的值不需符合row的長度，少的部分會是NaN值，注意: 如果有NaN值，那其它為數字的話，資料型態會是float64

          插入的方法基本上只有插入column的部分，使用insert指令
          df.insert(欲插入的位置, 欲插入的欄位名, 欲插入的值, allow_duplicates=True)
          給予的值需符合row的長度，allow_duplicates預設為False，此為是否允許插入同樣欄位名
          """          
          ```
    7. **刪除資料**
       + #### 範例
          ```python
          import pandas as pd

          # 創建資料
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, 190, 230]
          }

          data = pd.DataFrame(data_dict)  # 不指定index

          # data.drop(index=[1, 2], inplace=True, axis=False)
          # data.drop(columns=['name', 'salary'], inplace=True, axis=True)

          """
          基本上就是用drop指令
          : inplace是表示是否直接修改，預設為False
          : axis True為對column動作，False為對row動作，預設False
          : index是標籤名不是位置，不一定要此參數，會根據axis指定來判斷要對row還column作動
          : column是欄位名，不一定要此參數，會根據axis指定來判斷要對row還column作動
          """          
          ```
    8. **處理缺失值**
       + #### 範例
          ```python
          from numpy import NaN
          import pandas as pd

          # 創建資料
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, NaN, 230]
          }

          data = pd.DataFrame(data_dict)  # 不指定index

          # print(data.isnull())  # 查詢缺失值
          # print(data.dropna(how='all'))   # 刪除缺失值
          # print(data.fillna(0))
          # print(data.fillna({'heigh': 340}))

          """
          isnull指令為檢查缺失值
          dropna指令為刪除缺失值的row
          : how參數值'any'或'all'，當為any時，只要row中有一個NaN即整個row刪除，而all則是要全部都為NaN才刪除
          fillna指令為將所有缺失值填充為指定的值，也可利用字典的型式來給定
          """          
          ```
    9.  **處理重覆值**
       + #### 範例
          ```python
          import pandas as pd

          # 創建資料
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [3000, 5000, 8000],
              'heigh': [180, 190, 230]
          }

          data = pd.DataFrame(data_dict)  # 不指定index
          for i in range(5):
              data.loc[len(data)] = ['Amy', 3000, 180]
              
          data.loc[len(data)] = ['Amy', 4000, 180]
          print('原本的資料\n')
          print(data, '\n')

          # data = data.drop_duplicates()
          # print('刪除重複值後的結果\n')
          # print(data)

          # data = data.drop_duplicates(subset=['salary']) 
          # print('僅刪除salary欄位有重複值的結果\n')
          # print(data)

          # 取得為一值
          # print('名字有以下幾個\n')
          # print(data['name'].unique())

          """
          drop_duplicates為用來刪除重複的row
          : keep參數可以有3個值，'first'、'last'、False，預設為'first'
          : 'first'參數為保留第一個重複值剩下的刪除
          : 'last'參數為保留最後一個重複值剩下的刪除
          : False值為刪除所有的重複值
          : subset參數為column labels
          unique為用來獲取欄位中唯一值
          """          
          ```
    10. **排序資料**
       + #### 範例
          ```python
          import pandas as pd

          # 創建資料
          data_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [5000, 3000, 1000],
              'heigh': [980, 130, 190]
          }

          data = pd.DataFrame(data_dict)  # 不指定index

          # print(data.sort_values(by=['salary']))  # 根據salary欄位來作排序

          # print(data.sort_values(by=['heigh'], ascending=False))  # 根據salary欄位來作排降序

          """
          sort_values為排序值用的指令，基本上就是針對欄位作為排序
          : by參數為欲排序的欄位名
          : ascending參數為指定升降序，True為升序，False為降序，預設為True
          """          
          ```
    11. **合併資料**
       + #### 範例
          ```python
          import pandas as pd

          # 創建資料
          data1_dict = {
              'name': ['Amy', 'John', 'David'],
              'salary': [5000, 3000, 1000],
              'heigh': [980, 130, 190]
          }

          data2_dict = {
              'name': ['Linda', 'Emily'],
              'salary': [50000, 30000],
              'heigh': [150, 160]
          }


          data1 = pd.DataFrame(data1_dict)  # 不指定index
          data2 = pd.DataFrame(data2_dict)  # 不指定index

          # print(pd.concat([data1, data2], ignore_index=True))

          # print(data1.append(data2, ignore_index=True))

          """
          合併有兩種方法
          法1.
          concat: 合併兩個DataFrame，axis為0(預設)是row合併，1則是column合併，注意:只能0或1不能True跟False喔，另外，如果index不同的話，column合併會是row+column合併喔
          : ignore_index參數為忽略index，預設為False，也就是預設為不忽略index，合併之後的index不會重新排列，會按照原本的
          : axis，如果為0則為row合併，1為column合併，預設為0
          法2.
          append: 用法跟新增row一樣
          """          
          ```
    12. **對齊資料**
       + #### 範例
          ```python
          import pandas as pd

          # 創建資料
          data = {
              '收據編號': ['P02124179', 'P02124179', 'P02124183', 'P02124180', 'P02124087', 'P02125499', 'P02125307', 'P02125307', 'P02125256', 'P02125256', 'P02125259', 'P02125259'],
              '付款項目': ['規費', '服務費', '服務費', '服務費', '服務費', '服務費', '服務費', '規費', '服務費', '規費', '服務費', '規費'],
              '傳票號碼': ['J21100730045', 'J21100730046', 'J21100730046', 'J21100730047', 'J21100730048', 'F21100830001', 'F21100923001', 'F21100907009', 'F21101021001', 'F21101021002', 'F21101021003', 'F21101021004'],
              '預計付款日': ['2021/11/05', '2021/11/05', '2021/11/05', '2021/11/05', '2021/11/05', '2021/11/05', '2021/12/05', '2021/12/05', '2021/12/05', '2021/12/05', '2021/12/05', '2021/12/05'],
              '付款金額': [455, 1850, 700, 630, 700, 6000, 1000, 3341, 800, 350, 3150, 3787]
          }

          data = pd.DataFrame(data)
          pd.set_option('display.unicode.ambiguous_as_wide', True)    # 顯示對齊用
          pd.set_option('display.unicode.east_asian_width', True)     # 顯示對齊用
          print(data)          
          ```
    13. **其餘常用功能**
      + #### 範例
        ```python
        import pandas as pd

        # 創建資料
        data_dict = {
            'name': ['Amy', 'John', 'David'],
            'salary': [5000, 3000, 1000],
            'heigh': [980, 130, 190]
        }

        data = pd.DataFrame(data_dict)

        # print("薪水平均值:", data['salary'].mean())
        # print("薪水總和:", data['salary'].sum())
        # print("DataFrame的尺寸", data.shape)
        # print('欄位名:', data.columns)


        """
        mean: 欄位的平均值
        sum: 欄位的總和值
        shape: DataFrame的尺寸，m(row) * n(column)
        column: 欄位的名稱
        """        
        ```

+ ## 參考資料
  [參考網站](https://www.delftstack.com/zh-tw/howto/python-pandas/)
  [參考網站](https://pandas.pydata.org/docs/user_guide/index.html)
  [參考網站](https://iter01.com/585529.html)