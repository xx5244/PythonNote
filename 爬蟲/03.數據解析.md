# 數據解析
---

+ ## 必備模組
    **parsel模組**
    **這是有封裝CSS選擇器、正則表達式、Xpath**

+ ## 常見數據類型
    1. 結構化
        可以使用關聯式資料庫表示和儲存，表現為二維形式的資料。一般是以行為單位，有固定的欄位、格式與順序，一般人都看得懂的資料格式
    2. 非結構化
        沒有固定結構的資料，如:圖片、影片、音檔，一般為二進制的資料結構
    3. 半結構化
        有基本固定的結構模式的數據，如:log檔、XML檔、JSON檔


+ ## CSS選擇器
    **需轉換數據類型，將HTML轉換**
    **通常用於提取HTML標籤中的資料**
    | 名稱       | 符號                 | 功能                       |
    | :--------- | :------------------- | :------------------------- |
    | 標籤選擇器 | 直接用兩個單引號包住 | 篩選出指定標籤開頭的資料   |
    | 類別選擇器 | `.`為開頭            | 篩選出指定類別的資料       |
    | ID選擇器   | `#`為開頭            | 篩選出指定ID的資料         |
    | 屬性提取器 | `::`為開頭           | 提取標籤包含的屬性         |
    | 偽類選擇器 | `:`為開頭            | 指定想提取第幾個標籤的資料 |

    ```python
    import requests
    import parsel


    html = """
    <!DOCTYPE html>
    <html lang="en">
        <head>
            <meta charset="UTF-8">
            <title>標籤選擇器</title>
        </head>
        
        <style>
            p{
                color: #f00;
                font-size: 16px;
            }
        </style>
        
        <body>
            <p>css標籤選擇器</p>
            <p class="top" id="contend">標籤選擇器、類別選擇器、ID選擇器</p>
            <a id="text1" class="top1" href="https://www.baidu.com">百度一下1</a>
            <a id="text2" class="top2" href="https://www.baidu.com">百度一下2</a>
            <a id="text3" class="top2" href="https://www.baidu.com">百度一下3</a>
            <span>這裡是span標籤</span>
        </body>
    </html>
    """

    selector = parsel.Selector(html)    # 轉換資料類型(把html轉換成一個物件)

    ## 標籤選擇器
    # p = selector.css('p')   # 返回的是一個list，提取到了兩個物件
    # print(p)

    # p = selector.css('p').getall()  # 提取對象的資料，getall是全部提取，get僅是第一個對象的資料
    # print(p)


    ## 類別選擇器(.類別的屬性值)
    # p = selector.css('.top1').getall()
    # print(p)


    ## ID選擇器(#ID的值)
    # p = selector.css('#contend').getall()
    # print(p)


    ## 組合使用
    # p = selector.css('a.top2#text2').getall()
    # print(p)


    ## 屬性選擇器(::attr(屬性名稱))
    # p = selector.css('a#text2::text').getall()
    # print(p)
    # p = selector.css('a#text2::attr(href)').getall()
    # print(p)


    ## 偽類別選擇器(:)
    p = selector.css('a:first-of-type').getall()
    print(p)


    """
    chrome工具也可以用css選擇器語法來操作
    在chrome中，若要提取篩選出來的當前標籤下的標籤可用以下方式處理
        1. 子標籤(只會提取一層，孫子標籤不提取)時，可用大於符號(>)來處理
        2. 孫子標籤，可用空格來處理

    需先轉換資料，把HTML(字串)資料轉成物件

    標籤選擇器 直接打標籤名即可選擇
    類別選擇器 用點來開頭，標籤具有class屬性才能使用
    ID選擇器 用井號來開頭，一般ID為唯一值，標籤具有ID屬性才能使用
    組合使用 標籤選擇器一定要放最前面
    屬性選擇器 基於獲取標籤為前提，用雙冒號來開頭
        1. text獲取文本內容
        2. attr(屬性名稱)
    偽類別選擇器 用冒號來開頭，選擇第幾個元素
        1. first-of-type 選擇第一個元素
        2. last-of-type 選擇最後一個元素
        3. not(selector) 選擇selector以外的元素
        4. nth-cild(n)
            .n=n 全部
            .n=odd 奇數行
            .n=even 偶數行
            .n=3n+1 取出來是第1,4,7,10,13 (此數n是從0開始)
            .n=1,2,3 會取出第1,2,3 (注意，在python中，我測試結果此法很常失效，因此，取第幾個不建議用此法，建議用python的索引方法即可)
    """
    ```
+ ## 正則表達式
    + ### Regular Expression，常簡寫為regex、regexp或RE
    + ### 用來描述一系列符合某個句法規則的字串
    + ### 不需轉換數據類型，直接從字串中提取
    + ### 通常用於小範圍的字串提取
    + ### 每個字元自己獨立，然後決定單位數量進行匹配
        | **符號**          | **用途**                                                                               |
        | :---------------- | :------------------------------------------------------------------------------------- |
        | `.`               | 全部字元                                                                               |
        | `\`               | 跳脫字元                                                                               |
        | `\w`              | 匹配大小寫英文字母及數字及下划線                                                       |
        | `\W`              | 匹配除了大小寫英文字母及數字及下划線之外的字元                                         |
        | `\d`              | 匹配數字                                                                               |
        | `\D`              | 匹配非數字                                                                             |
        | `\s`              | 匹配所有類型的空格(\t\n\r\f\v)                                                         |
        | `\S`              | 匹配所有非空格的字元                                                                   |
        | `[]`              | 匹配裡面的任何字元，整體僅佔一個字元                                                   |
        | `[m-n]`           | -為設定匹配範圍從m到n                                                                  |
        | `[\m]`            | m為0~377的8進制數字，會匹配對應的ASCII Code                                            |
        | `[^]`             | 取反字元，不匹配[]內的字元                                                             |
        | `\b`              | 單詞的邊界，指的是單詞與空格之間的位置，使用時，\b的左右兩側一定有一側不是\w才能匹配到 |
        | `^`               | 起始字元                                                                               |
        | `$`               | 結束字元                                                                               |
        | `{m}`             | 剛好m個                                                                                |
        | `{m, n}`          | m to n個，n預設為無窮大，可以省略不寫                                                  |
        | `{m, n}?`         | m to n個，盡可能少                                                                     |
        | `*`               | 0 or more = {0,}                                                                       |
        | `+`               | 1 or more = {1,}                                                                       |
        | `?`               | 0 or 1                                                                                 |
        | `|`               | or條件，配對                                                                           | 的左側條件或右側條件 |
        | `()`              | 代表一個組別                                                                           |
        | `\n`              | 組別的回溯引用，n為第幾組分組                                                          |
        | `(?:)`            | 代表不要提取這組的內容(不算分組)                                                       |
        | `(?=表達式)`      | 正向先行斷言，該位置往右看，必須符合表達式才會匹配，但不會提取(不算分組)               |
        | `(?!表達式)`      | 反向先行斷言，該位置往右看，必須不符合表達式才會匹配，但不會提取(不算分組）            |
        | `(?<=表達式)`     | 正向後行斷言，該位置往左看，必須符合表達式才會匹配，但不會提取(不算分組)               |
        | `(?<!表達式)`     | 反向後行斷言，該位置往左看，必須不符合表達式才會匹配，但不會提取(不算分組)             |
        | `[0-9]`           | 匹配數字                                                                               |
        | `[a-z]`           | 匹配小寫英文字母                                                                       |
        | `[A-Z]`           | 匹配大寫英文字母                                                                       |
        | `[\u4e00-\u9fa5]` | 匹配中文                                                                               |
        [測試工具](https://regexr-cn.com/)
        [練習網站](https://codejiaonang.com/#/course/regex_chapter1/0/0)
        [練習網站](https://codejiaonang.com/#/course/regex_chapter2/0/0)
        
    + ### 範例
        ```python
        import re
        pattern = 'python'
        string = 'apythonaeijfoijeofijsopythonfiesfsefhtb'

        print(re.match(pattern, string))
        print(re.search(pattern, string))
        print(re.findall(pattern, string))
        print(re.split(pattern, string, 1))
        print(re.compile(pattern, re.S))
        replace_string = 'repl'
        print(re.sub(pattern, replace_string, string, 1))

        """
        match 一次性匹配，如果沒匹配到則回傳None，從字串的開頭開始匹配
        search 一次性匹配，如果沒匹配到則回傳None，搜尋整個字符，與match差異在，如果搜尋的字樣在是字串的子字串的話是可以找得到的
        findall 多次匹配，返回是個list
        split 用匹配到的子字串分割字串後返回list，可設定分割次數，預設是分割最大次
        compile 將正則的字串型式編譯成pattern對象
        sub 用於替換，可以設定替換次數，預設是替換最大次
        """
        ```

+ ## Xpath選擇器
    **需轉換數據類型，將HTML轉換**
    **通常用於json、xml數據提取，亦可用於html提取**
